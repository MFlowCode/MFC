name: PMD

on: [push, pull_request, workflow_dispatch]

jobs:    
  pmd:
      name: PMD Analysis
      runs-on: "ubuntu-latest"
      env:
          pr_everything: 0
      steps:
          - name: Clone - PR
            uses: actions/checkout@v4

          - name: Set up Java
            uses: actions/setup-java@v4
            with:
              distribution: temurin
              java-version: '17'

          - name: Run CPD for Fortran
            continue-on-error: true
            env:
              PMD_VERSION: 7.14.0
            run: |
              curl -sSL \
                "https://github.com/pmd/pmd/releases/download/pmd_releases/${PMD_VERSION}/pmd-dist-${PMD_VERSION}-bin.zip"
              unzip -q pmd.zip
              PMD_HOME="pmd-bin-${PMD_VERSION}"
          
              "${PMD_HOME}/bin/pmd" cpd \
                --dir src \
                --language fortran \
                --minimum-tokens=10 \
                --fail-on-violation false 
